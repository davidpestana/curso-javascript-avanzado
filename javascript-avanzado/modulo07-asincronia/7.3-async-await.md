

# 7.3 Async / Await

## ⚡ ¿Qué es async/await?

Es **una forma moderna de trabajar con Promesas** pero con sintaxis parecida al código síncrono.
Es decir, hace que el código asíncrono se lea como si fuera paso a paso.

---

## ✅ Reglas básicas

* `async` se usa para declarar una función asíncrona
* Dentro de una función async, puedes usar `await`
* `await` se **detiene hasta que la promesa se resuelva**

---

## ✏️ Ejemplo básico

```js
function promesaSimple() {
  return Promise.resolve("Resultado ok ✅");
}

async function ejecutar() {
  const resultado = await promesaSimple();
  console.log(resultado);
}

ejecutar();
```

---

## 🔧 Reemplazando `.then()` por async/await

Antes con promesas encadenadas:

```js
obtenerUsuario()
  .then(user => obtenerPedidos(user.id))
  .then(pedidos => console.log(pedidos))
  .catch(error => console.log(error));
```

Ahora más limpio:

```js
async function cargarDatos() {
  try {
    const user = await obtenerUsuario();
    const pedidos = await obtenerPedidos(user.id);
    console.log(pedidos);
  } catch (error) {
    console.log(error);
  }
}
```

---

## 🧯 Manejo de errores

Usamos `try/catch` para capturar errores con async/await.

```js
async function dividir(a, b) {
  try {
    if (b === 0) throw new Error("No se puede dividir por cero");
    return a / b;
  } catch (error) {
    console.log("Error:", error.message);
  }
}
```

---

## 🔄 Ejecutar promesas en paralelo con await

Si no hay dependencia entre llamadas, mejor paralelas:

```js
async function cargarTodo() {
  const promesa1 = obtenerProductos();
  const promesa2 = obtenerUsuarios();

  const [productos, usuarios] = await Promise.all([promesa1, promesa2]);
}
```

---

# 🛠 Laboratorio

## 🎯 Objetivos

* Usar async/await correctamente
* Convertir código con .then() a async/await
* Manejar errores con try/catch
* Usar Promise.all con await

---

### Ejercicio 1 — Función async básica

```js
async function saludo() {
  return "Hola desde async 👋";
}
saludo().then(console.log);
```

---

### Ejercicio 2 — Usar await

```js
function dameNumero() {
  return Promise.resolve(42);
}

async function mostrarNumero() {
  const n = await dameNumero();
  console.log(n);
}

mostrarNumero();
```

---

### Ejercicio 3 — try/catch obligatorio

```js
async function obtenerUsuario(id) {
  if (!id) throw new Error("ID requerido");
  return { id, nombre: "Ada" };
}

async function main() {
  try {
    const user = await obtenerUsuario(1);
    console.log(user);
  } catch (e) {
    console.log("Error:", e.message);
  }
}

main();
```

---

### Ejercicio 4 — Convertir .then() a async/await

Antes:

```js
fetchDatos().then(d => console.log(d));
```

Ahora:

```js
async function cargar() {
  const datos = await fetchDatos();
  console.log(datos);
}
```

---

### Ejercicio 5 — Ejecución en paralelo

```js
async function cargarTodo() {
  const a = Promise.resolve("A");
  const b = Promise.resolve("B");
  const c = Promise.resolve("C");

  const resultados = await Promise.all([a, b, c]);
  console.log(resultados); // ["A", "B", "C"]
}
```

---

## 🚀 Retos

1. Crea `esperar(ms)` como promesa y úsala con await.
2. Hace login con demora de 2 segundos y luego muestra "Bienvenido".
3. Consulta tres APIs falsas en paralelo usando Promise.all.

