# 7.4 Uso de la API fetch

## 🌐 ¿Qué es fetch?

`fetch()` es la forma moderna de hacer **peticiones HTTP** en JavaScript para obtener datos de un servidor o enviar información.

Funciona con **promesas** y es nativo del navegador (también está disponible en Node.js moderno).

---

## ✅ Sintaxis básica

```js
fetch(url)
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error("Error:", error));
```

---

## ✨ Con async/await (forma moderna recomendada)

```js
async function cargarDatos() {
  try {
    const respuesta = await fetch("https://jsonplaceholder.typicode.com/users");
    const datos = await respuesta.json();
    console.log(datos);
  } catch (error) {
    console.error("Algo salió mal:", error);
  }
}
cargarDatos();
```

---

## 📡 Métodos HTTP con fetch

Por defecto, fetch usa **GET**, pero podemos enviar datos usando **POST**, **PUT**, **DELETE**, etc.

```js
fetch("https://api.example.com/users", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ nombre: "Ada", edad: 36 })
});
```

---

## ❗ Manejo de errores HTTP

fetch **no lanza error automáticamente** si el servidor responde con 404 o 500.
Debemos comprobar manualmente `response.ok`.

```js
async function cargar() {
  const res = await fetch("https://api.example.com/404");
  if (!res.ok) throw new Error("Error HTTP: " + res.status);
}
```

---

## 🧱 Headers (cabeceras)

```js
fetch("https://api.example.com/test", {
  headers: {
    "Authorization": "Bearer token123",
    "Accept": "application/json"
  }
});
```

---

## 🏗️ Enviar JSON con POST

```js
async function enviar() {
  const res = await fetch("https://jsonplaceholder.typicode.com/posts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ titulo: "Hola", cuerpo: "Estoy probando fetch" })
  });
  const data = await res.json();
  console.log("Respuesta:", data);
}
enviar();
```

---

# 🛠 Laboratorio

## 🎯 Objetivos

* Hacer peticiones GET y POST con fetch
* Leer respuestas de servidores
* Manejar errores HTTP
* Usar async/await con fetch

---

### Ejercicio 1 — GET simple

Obtén usuarios de una API pública.

```js
async function getUsuarios() {
  const res = await fetch("https://jsonplaceholder.typicode.com/users");
  const data = await res.json();
  console.log(data);
}
getUsuarios();
```

---

### Ejercicio 2 — Manejo de error HTTP

```js
async function traerDatos() {
  const res = await fetch("https://jsonplaceholder.typicode.com/404");
  if (!res.ok) {
    console.log("Error HTTP:", res.status);
    return;
  }
}
traerDatos();
```

---

### Ejercicio 3 — Enviar datos con POST

```js
async function crearPost() {
  const res = await fetch("https://jsonplaceholder.typicode.com/posts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title: "Nuevo", body: "Probando" })
  });
  console.log(await res.json());
}
crearPost();
```

---

### Ejercicio 4 — Fetch + DOM

Carga una lista de usuarios y muéstrala en la página.

```js
async function mostrarUsuarios() {
  const res = await fetch("https://jsonplaceholder.typicode.com/users");
  const data = await res.json();

  const lista = document.getElementById("usuarios");
  data.forEach(u => {
    const li = document.createElement("li");
    li.textContent = u.name;
    lista.appendChild(li);
  });
}
```

---

### Ejercicio 5 — Fetch con try/catch

```js
async function traer() {
  try {
    const res = await fetch("https://jsonplaceholder.typicode.com/posts/1");
    const data = await res.json();
    console.log(data);
  } catch (error) {
    console.error("Error en fetch:", error);
  }
}
```

---

## 🚀 Retos

1. Haz un mini buscador de usuarios con fetch.
2. Envía un formulario usando fetch en lugar de submit clásico.
3. Captura y muestra errores de red con un mensaje visible al usuario.